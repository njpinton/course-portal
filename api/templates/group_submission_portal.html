<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Group Submission Portal - CMSC 173</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1B5E4F 0%, #2D4F47 50%, #7A1E3F 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1B5E4F 0%, #7A1E3F 100%);
            color: white;
            padding: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 0.95em;
            opacity: 0.9;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background-color: #D4AF37;
            color: #1B5E4F;
        }

        .btn-primary:hover {
            background-color: #FFC700;
            transform: translateY(-2px);
        }

        .btn-danger {
            background-color: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
        }

        .btn-danger:hover {
            background-color: rgba(255,255,255,0.3);
        }

        .content {
            padding: 40px;
        }

        .error-message {
            background: #ffcdd2;
            border-left: 4px solid #dc3545;
            color: #c62828;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .group-info {
            background: linear-gradient(135deg, #f5f5f5 0%, #ffffff 100%);
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #1B5E4F;
        }

        .group-header {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 20px;
        }

        .group-detail {
            display: flex;
            flex-direction: column;
        }

        .group-detail label {
            font-weight: 600;
            color: #666;
            margin-bottom: 5px;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .group-detail value {
            font-size: 1.2em;
            color: #333;
            font-weight: 600;
        }

        .feedback-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #7A1E3F, #1B5E4F);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }

        .feedback-button:hover {
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
            transform: scale(1.1);
        }

        .feedback-button:active {
            transform: scale(0.95);
        }

        .stages-container {
            display: grid;
            gap: 20px;
        }

        .stage-card {
            background: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .stage-card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .stage-header {
            background: linear-gradient(135deg, #1B5E4F 0%, #2D4F47 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }

        .stage-header:hover {
            background: linear-gradient(135deg, #0F3E35 0%, #1B2A27 100%);
        }

        .stage-number {
            width: 50px;
            height: 50px;
            background: #D4AF37;
            color: #1B5E4F;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            margin-right: 20px;
        }

        .stage-title {
            flex: 1;
        }

        .stage-title h3 {
            font-size: 1.3em;
            margin-bottom: 5px;
        }

        .stage-weight {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .stage-status {
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85em;
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .stage-content {
            padding: 25px;
            display: none;
        }

        .stage-content.active {
            display: block;
        }

        .stage-description {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 3px solid #2196F3;
        }

        .stage-description h4 {
            color: #2196F3;
            margin-bottom: 10px;
        }

        .submission-area {
            background: white;
            padding: 20px;
            border-radius: 5px;
            border: 2px dashed #ddd;
            margin-bottom: 20px;
        }

        .submission-area h4 {
            color: #1B5E4F;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .form-group textarea,
        .form-group input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
            font-size: 0.95em;
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-group textarea:focus,
        .form-group input:focus {
            outline: none;
            border-color: #1B5E4F;
            box-shadow: 0 0 0 3px rgba(27,94,79,0.1);
        }

        .btn-submit {
            background-color: #1B5E4F;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
        }

        .btn-submit:hover {
            background-color: #0F3E35;
        }

        .submission-status {
            background: white;
            padding: 15px;
            border-radius: 5px;
            border-left: 3px solid #4CAF50;
            margin-top: 15px;
        }

        .submission-status.submitted {
            border-left-color: #4CAF50;
            background: #e8f5e9;
        }

        .submission-status.pending {
            border-left-color: #FF9800;
            background: #fff3e0;
        }

        .submission-status.graded {
            border-left-color: #2196F3;
            background: #e3f2fd;
        }

        .submission-status h5 {
            margin-bottom: 8px;
            color: #333;
        }

        .submission-meta {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }

        .grade-badge {
            display: inline-block;
            background: #4CAF50;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .feedback {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 3px;
            border-left: 3px solid #2196F3;
            font-size: 0.95em;
        }

        .feedback strong {
            color: #2196F3;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .alert.success {
            background: #c8e6c9;
            border-left: 4px solid #4CAF50;
            color: #2e7d32;
        }

        .alert.error {
            background: #ffcdd2;
            border-left: 4px solid #dc3545;
            color: #c62828;
        }

        .footer {
            background: #f5f5f5;
            padding: 20px;
            text-align: center;
            border-top: 1px solid #eee;
            color: #999;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .group-header {
                grid-template-columns: 1fr;
            }

            .stage-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .stage-number {
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>üìö {{ group_name }} - Submission Portal</h1>
                <p>CMSC 173 - Machine Learning</p>
            </div>
            <div class="header-actions">
                <a href="/group_portal" class="btn btn-primary">‚Üê Back to Group Portal</a>
                <a href="/group_logout" class="btn btn-danger">Logout</a>
            </div>
        </div>

        <div class="content">
            <!-- PROJECT STAGES & SUBMISSIONS -->
            <h2 style="color: #1B5E4F; margin-bottom: 25px; display: flex; align-items: center;">
                <span style="width: 40px; height: 40px; background: #D4AF37; color: #1B5E4F; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 15px;">6</span>
                Project Stages & Submissions
            </h2>

            <div class="stages-container">
                {% set stage_names = ["Proposal", "Data & Preprocessing", "Model Training", "Evaluation", "Final Report", "Presentation"] %}
                {% set stage_weights = [10, 15, 20, 20, 20, 15] %}
                {% for i in range(6) %}
                <div class="stage-card">
                    <div class="stage-header" onclick="toggleStage({{ i }})">
                        <div style="display: flex; align-items: center; flex: 1;">
                            <div class="stage-number">{{ i + 1 }}</div>
                            <div class="stage-title">
                                <h3>{{ stage_names[i] }}</h3>
                                <span class="stage-weight">{{ stage_weights[i] }}% of grade</span>
                            </div>
                        </div>
                        <div class="stage-status" id="status-{{ i }}">
                            {% if group.submissions and group.submissions[i] %}
                                ‚úì Submitted
                            {% else %}
                                ‚óã Not Submitted
                            {% endif %}
                        </div>
                    </div>

                    <div class="stage-content" id="stage-{{ i }}">
                        <!-- STAGE DESCRIPTION -->
                        <div class="stage-description">
                            <h4>üìã Description</h4>
                            {% set descriptions = [
                                "Define your project idea, objectives, and methodology. This should include a literature review and proposed approach.",
                                "Gather, clean, and preprocess your data. Include exploratory data analysis and visualization.",
                                "Train your machine learning model(s). Document your approach, hyperparameters, and training results.",
                                "Evaluate your model's performance. Include metrics, comparisons, and analysis of results.",
                                "Compile your final report with all findings, visualizations, and conclusions.",
                                "Present your project to the class. Prepare slides and be ready to answer questions."
                            ] %}
                            <p>{{ descriptions[i] }}</p>
                        </div>

                        <!-- GUIDE QUESTIONS -->
                        <div class="stage-description" style="background-color: #f9f3ff; padding: 15px; border-radius: 8px; margin-top: 15px;">
                            <h4>‚ùì Guide Questions</h4>
                            {% set guide_questions = [
                                [
                                    "What is your project topic and why is it important?",
                                    "What are your specific research objectives?",
                                    "What dataset(s) will you use?",
                                    "What machine learning techniques will you apply?",
                                    "What are your expected outcomes?"
                                ],
                                [
                                    "What is the source and size of your dataset?",
                                    "What data quality issues did you encounter?",
                                    "What preprocessing steps did you apply?",
                                    "How did you handle missing values and outliers?",
                                    "What insights did your exploratory analysis reveal?"
                                ],
                                [
                                    "Which models did you train and why?",
                                    "What were your hyperparameter choices?",
                                    "How many epochs/iterations did you train?",
                                    "What validation strategy did you use?",
                                    "What was your training time and computational resources used?"
                                ],
                                [
                                    "What metrics did you use to evaluate performance?",
                                    "How does your model compare to baseline models?",
                                    "What are the strengths and weaknesses of your model?",
                                    "How did you handle class imbalance (if applicable)?",
                                    "What are the practical implications of your results?"
                                ],
                                [
                                    "What are your main findings and conclusions?",
                                    "How do your results answer your research questions?",
                                    "What limitations did you encounter?",
                                    "What are potential applications of your work?",
                                    "What improvements or future work would you recommend?"
                                ],
                                [
                                    "Can you explain your methodology clearly?",
                                    "Did you present your results with visualizations?",
                                    "How did you address questions from the audience?",
                                    "Did you stay within the time limit?",
                                    "Did you demonstrate understanding of your work?"
                                ]
                            ] %}
                            <ul style="margin-left: 20px;">
                                {% for question in guide_questions[i] %}
                                <li style="margin-bottom: 8px;">{{ question }}</li>
                                {% endfor %}
                            </ul>
                        </div>

                        <!-- SUBMISSION FORM -->
                        <div class="submission-area">
                            <h4>üì§ Submit Work</h4>
                            <div style="background-color: #fffacd; padding: 12px; border-radius: 5px; margin-bottom: 15px; border-left: 4px solid #ffa500;">
                                <strong>Required Submissions:</strong>
                                <ul style="margin-top: 8px; margin-bottom: 0; padding-left: 20px;">
                                    <li><strong>Summary PDF</strong> - A PDF document summarizing your work for this stage</li>
                                    <li><strong>Presentation</strong> - Either upload a presentation file (PPTX/PDF) OR provide a link to your presentation (Google Slides, Canva, etc.)</li>
                                </ul>
                            </div>
                            <form onsubmit="submitStageWork(event, {{ i + 1 }})">
                                <div class="form-group">
                                    <label><strong>üìÑ Summary PDF (Required)</strong></label>
                                    <input type="file" id="file-{{ i }}" accept=".pdf" required>
                                    <small style="color: #999; display: block; margin-top: 5px;">
                                        Upload a PDF summary of your work for this stage (Max 50MB)
                                    </small>
                                </div>

                                <div class="form-group">
                                    <label><strong>üéØ Presentation Slides (Required)</strong></label>
                                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                        <select id="presentation-type-{{ i }}" onchange="togglePresentationInput({{ i }})" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                            <option value="">-- Select presentation type --</option>
                                            <option value="upload">Upload as PDF/PPTX</option>
                                            <option value="link">Provide link (Google Slides, Canva, etc.)</option>
                                        </select>
                                    </div>

                                    <div id="upload-presentation-{{ i }}" style="display: none;">
                                        <input type="file" id="presentation-file-{{ i }}" accept=".pdf,.pptx">
                                        <small style="color: #999; display: block; margin-top: 5px;">
                                            Upload presentation as PDF or PPTX (Max 50MB)
                                        </small>
                                    </div>

                                    <div id="link-presentation-{{ i }}" style="display: none;">
                                        <input type="url" id="presentation-link-{{ i }}" placeholder="https://docs.google.com/presentation/d/..." style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                        <small style="color: #999; display: block; margin-top: 5px;">
                                            Paste the shareable link to your presentation (must be publicly accessible)
                                        </small>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>Additional Notes (Optional)</label>
                                    <textarea id="content-{{ i }}" placeholder="Add any additional notes or details about your submission..."></textarea>
                                </div>

                                <button type="submit" class="btn-submit">Submit Stage {{ i + 1 }}</button>
                            </form>
                        </div>

                        <!-- SUBMISSION STATUS -->
                        {% if group.submissions and group.submissions[i] %}
                        <div class="submission-status submitted">
                            <h5>‚úì Submission Recorded</h5>
                            <div class="submission-meta">
                                Submitted: {{ group.submissions[i].submitted_at[:19] }}
                            </div>
                            {% if group.submissions[i].file_name %}
                                <div class="submission-meta">
                                    üìé File: {{ group.submissions[i].file_name }}
                                </div>
                            {% endif %}
                            {% if group.feedback and group.feedback[i] %}
                                {% if group.feedback[i].grade %}
                                    <div style="margin-top: 10px;">
                                        <span class="grade-badge">Grade: {{ group.feedback[i].grade }}/10</span>
                                    </div>
                                {% endif %}
                                {% if group.feedback[i].feedback_text %}
                                    <div class="feedback">
                                        <strong>Instructor Feedback:</strong><br>
                                        {{ group.feedback[i].feedback_text }}
                                    </div>
                                {% endif %}
                            {% endif %}
                        </div>
                        {% else %}
                        <div class="submission-status pending">
                            <h5>No submission yet</h5>
                            <p style="color: #666;">Submit your work above to get started on this stage.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="footer">
            <p>CMSC 173 Group Project Portal | ¬© 2025 University of the Philippines Cebu</p>
        </div>
    </div>

    <script>
        function toggleStage(index) {
            const content = document.getElementById(`stage-${index}`);
            if (content) {
                content.classList.toggle('active');
            }
        }

        // Auto-expand first stage
        document.addEventListener('DOMContentLoaded', () => {
            const firstStage = document.getElementById('stage-0');
            if (firstStage) {
                firstStage.classList.add('active');
            }
        });

        function togglePresentationInput(stageIndex) {
            const presentationType = document.getElementById(`presentation-type-${stageIndex}`).value;
            const uploadDiv = document.getElementById(`upload-presentation-${stageIndex}`);
            const linkDiv = document.getElementById(`link-presentation-${stageIndex}`);

            if (presentationType === 'upload') {
                uploadDiv.style.display = 'block';
                linkDiv.style.display = 'none';
            } else if (presentationType === 'link') {
                uploadDiv.style.display = 'none';
                linkDiv.style.display = 'block';
            } else {
                uploadDiv.style.display = 'none';
                linkDiv.style.display = 'none';
            }
        }

        async function submitStageWork(event, stageNumber) {
            event.preventDefault();

            const stageIndex = stageNumber - 1;
            const content = document.getElementById(`content-${stageIndex}`).value;
            const summaryFile = document.getElementById(`file-${stageIndex}`).files[0];
            const presentationType = document.getElementById(`presentation-type-${stageIndex}`).value;

            let presentationFile = null;
            let presentationLink = null;

            if (presentationType === 'upload') {
                presentationFile = document.getElementById(`presentation-file-${stageIndex}`).files[0];
                if (!presentationFile) {
                    alert('Please select a presentation file to upload');
                    return;
                }
            } else if (presentationType === 'link') {
                presentationLink = document.getElementById(`presentation-link-${stageIndex}`).value.trim();
                if (!presentationLink) {
                    alert('Please provide a presentation link');
                    return;
                }
            } else {
                alert('Please select a presentation type (upload or link)');
                return;
            }

            if (!summaryFile) {
                alert('Please upload a summary PDF file');
                return;
            }

            try {
                // Submit with summary PDF, presentation, and optional content
                const formData = new FormData();
                formData.append('file', summaryFile);
                if (presentationFile) {
                    formData.append('presentation_file', presentationFile);
                }
                if (presentationLink) {
                    formData.append('presentation_link', presentationLink);
                }
                if (content) {
                    formData.append('content', content);
                }
                formData.append('stage_number', stageNumber);

                const response = await fetch('/api/group/submit', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const error = await response.json();
                    alert('Error: ' + (error.error || 'Failed to submit'));
                    return;
                }

                alert('Submission successful! Your work has been recorded.');
                location.reload();

            } catch (error) {
                alert('Error submitting work: ' + error.message);
            }
        }

        function openFeedbackForm() {
            const feedback = prompt(
                'Please share your feedback or report an issue:\n\n' +
                '(Your message will help us improve the application)',
                ''
            );
            if (feedback && feedback.trim()) {
                alert('Thank you for your feedback! We appreciate your input.');
                console.log('Feedback:', feedback);
            }
        }
    </script>

    <!-- Feedback Button -->
    <button class="feedback-button" onclick="openFeedbackForm()" title="Report issue or feedback">üí¨</button>
</body>
</html>
