{% extends "base_layout.html" %}

{% block title %}Group Project Portal - CMSC 173{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/group-portal.css') }}">
{% endblock %}

{% block breadcrumbs %}
<a href="/" class="breadcrumb-item">Home</a>
<span class="breadcrumb-separator">/</span>
<span class="breadcrumb-current">Group Portal</span>
{% endblock %}

{% block content %}
<!-- Toast Container -->
<div id="toastContainer" class="toast-container" role="alert" aria-live="polite"></div>

<!-- Page Header -->
<header class="portal-header">
    <h1 class="portal-title">Group Project Portal</h1>
</header>

<!-- Action Buttons -->
<div class="actions-container">
    <button type="button" id="showCreateGroupBtn" class="btn btn-primary btn-lg" aria-expanded="false" aria-controls="createGroupSection">
        <span aria-hidden="true">+</span> Create New Group
    </button>
    <a href="/group_login" class="btn btn-secondary btn-lg">
        <span aria-hidden="true">&#128274;</span> Group Login
    </a>
</div>

<!-- Create Group Form -->
<section id="createGroupSection" class="form-section hidden" aria-labelledby="createGroupTitle">
    <h2 id="createGroupTitle" class="form-section-title">Create New Group</h2>

    <form id="createGroupForm" novalidate>
        <!-- Group Information -->
        <div class="form-card">
            <h3 class="form-card-title">
                <span aria-hidden="true">&#128203;</span> Group Information
            </h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="groupName" class="form-label required">Group Name</label>
                    <input type="text" id="groupName" name="group_name" class="form-input"
                           placeholder="e.g., Team Alpha, The Innovators" required
                           aria-describedby="groupNameHelp">
                    <span id="groupNameHelp" class="form-help">Choose a unique name for your group</span>
                </div>
                <div class="form-group">
                    <label for="projectTitle" class="form-label required">Project Title</label>
                    <input type="text" id="projectTitle" name="project_title" class="form-input"
                           placeholder="e.g., ML Image Classifier" required>
                </div>
            </div>
        </div>

        <!-- Login Credentials -->
        <div class="form-card credentials">
            <h3 class="form-card-title">
                <span aria-hidden="true">&#128274;</span> Login Credentials
            </h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="groupUsername" class="form-label required">Username</label>
                    <input type="text" id="groupUsername" name="username" class="form-input"
                           placeholder="Choose a unique username" required autocomplete="off">
                </div>
                <div class="form-group">
                    <label for="groupPassword" class="form-label required">Password</label>
                    <input type="password" id="groupPassword" name="password" class="form-input"
                           placeholder="Min 6 characters" required minlength="6" autocomplete="new-password"
                           aria-describedby="passwordHelp">
                    <span id="passwordHelp" class="form-help">Password must be at least 6 characters</span>
                </div>
            </div>
        </div>

        <!-- Group Members -->
        <div class="form-card members">
            <h3 class="form-card-title">
                <span aria-hidden="true">&#128101;</span> Group Members
            </h3>

            <div class="search-container">
                <span class="search-icon" aria-hidden="true">&#128269;</span>
                <input type="text" id="studentSearch" class="search-input"
                       placeholder="Search students by name or ID..."
                       aria-label="Search for students to add to group"
                       aria-describedby="searchHelp"
                       aria-expanded="false"
                       aria-controls="studentsList"
                       autocomplete="off">
                <ul id="studentsList" class="search-dropdown" role="listbox" aria-label="Available students"></ul>
            </div>
            <span id="searchHelp" class="form-help">Start typing to search available students</span>

            <div id="selectedMembers" class="members-container" aria-live="polite">
                <p id="noMembersMsg" class="members-empty">No members added yet. Search above to add students.</p>
            </div>

            <div id="classAlert" class="alert-box alert-box-info hidden" role="status">
                <span id="classAlertText"></span>
            </div>
        </div>

        <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">
            <span aria-hidden="true">&#10024;</span> Create Group
        </button>
    </form>
</section>

<!-- Existing Groups -->
<section class="form-section" aria-labelledby="groupsTitle">
    <div class="groups-header">
        <h2 id="groupsTitle" class="groups-title">Existing Groups</h2>
        <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap;">
            <div class="search-container" style="margin-bottom: 0; min-width: 200px; flex: 1; max-width: 300px;">
                <span class="search-icon" aria-hidden="true">&#128269;</span>
                <input type="text" id="groupSearch" class="search-input"
                       placeholder="Search groups..."
                       aria-label="Search groups by name or project">
            </div>
            <div class="view-toggle" role="tablist" aria-label="View options">
                <button type="button" id="viewKanban" class="view-toggle-btn active" role="tab" aria-selected="true">
                    <span aria-hidden="true">&#128202;</span> Cards
                </button>
                <button type="button" id="viewList" class="view-toggle-btn" role="tab" aria-selected="false">
                    <span aria-hidden="true">&#128203;</span> List
                </button>
            </div>
        </div>
    </div>
    <div id="groupsList" role="tabpanel" aria-label="Groups list">
        <div class="loading-state">
            <div class="spinner lg"></div>
            <p>Loading groups...</p>
        </div>
    </div>
</section>

<!-- Group Details Modal -->
<div id="groupDetailsModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="modalGroupName">
    <div class="modal">
        <header class="modal-header">
            <h2 id="modalGroupName" class="modal-title">Group Details</h2>
            <button type="button" class="modal-close" aria-label="Close modal">
                <span aria-hidden="true">&times;</span>
            </button>
        </header>
        <div id="modalContent" class="modal-body">
            <div class="loading-state">
                <div class="spinner"></div>
                <p>Loading...</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Pass server-side config to JS
    window.groupPortalConfig = { isAdmin: {{ session.get('is_admin', False) | tojson }} };
</script>
<script src="{{ url_for('static', filename='js/group-portal.js') }}"></script>
{% endblock %}
