<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 420" role="img" aria-label="Bilateral filter demonstration showing edge-preserving smoothing">
  <title>Bilateral Filter Demo</title>
  <desc>Visualization of bilateral filter combining spatial and intensity (range) weights for edge-preserving smoothing</desc>

  <defs>
    <linearGradient id="bilateralBg" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f8f9fa"/>
      <stop offset="100%" style="stop-color:#e9ecef"/>
    </linearGradient>
    <linearGradient id="spatialGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:0.1"/>
      <stop offset="50%" style="stop-color:#3b82f6;stop-opacity:0.8"/>
      <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:0.1"/>
    </linearGradient>
    <linearGradient id="rangeGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#10b981;stop-opacity:0.1"/>
      <stop offset="50%" style="stop-color:#10b981;stop-opacity:0.8"/>
      <stop offset="100%" style="stop-color:#10b981;stop-opacity:0.1"/>
    </linearGradient>
  </defs>

  <rect width="800" height="420" fill="url(#bilateralBg)" rx="8"/>

  <!-- Title -->
  <text x="400" y="35" fill="#1a3a6e" font-family="Segoe UI, sans-serif" font-size="20" font-weight="600" text-anchor="middle">Bilateral Filter: Edge-Preserving Smoothing</text>

  <!-- Formula -->
  <g transform="translate(200, 55)">
    <rect x="0" y="0" width="400" height="50" fill="white" rx="8" stroke="#1a3a6e" stroke-width="2"/>
    <text x="200" y="32" fill="#1a3a6e" font-family="Segoe UI, sans-serif" font-size="14" font-weight="600" text-anchor="middle">
      BF[I]<tspan font-size="10" dy="3">p</tspan><tspan dy="-3"> = </tspan>
      <tspan fill="#3b82f6">G<tspan font-size="10" dy="3">s</tspan></tspan><tspan dy="-3">(||p-q||)</tspan>
      <tspan> × </tspan>
      <tspan fill="#10b981">G<tspan font-size="10" dy="3">r</tspan></tspan><tspan dy="-3">(|I<tspan font-size="10" dy="3">p</tspan><tspan dy="-3">-I</tspan><tspan font-size="10" dy="3">q</tspan>|)</tspan>
    </text>
  </g>

  <!-- Main visualization area -->
  <g transform="translate(50, 120)">
    <!-- Spatial Weight (Left) -->
    <g transform="translate(0, 0)">
      <text x="100" y="0" fill="#3b82f6" font-family="Segoe UI, sans-serif" font-size="14" font-weight="600" text-anchor="middle">Spatial Weight (G<tspan font-size="10" dy="3">s</tspan><tspan dy="-3">)</tspan></text>
      <text x="100" y="18" fill="#666" font-family="Segoe UI, sans-serif" font-size="11" text-anchor="middle">Distance from center</text>

      <!-- Gaussian kernel visualization -->
      <g transform="translate(0, 35)">
        <rect x="0" y="0" width="200" height="130" fill="white" rx="6" stroke="#3b82f6" stroke-width="1"/>

        <!-- Distance-based weights -->
        <g transform="translate(20, 15)">
          <!-- 5x5 grid showing spatial weights -->
          <g fill="#dbeafe" stroke="#3b82f6" stroke-width="0.5">
            <rect x="0" y="0" width="32" height="20" fill-opacity="0.2"/>
            <rect x="32" y="0" width="32" height="20" fill-opacity="0.4"/>
            <rect x="64" y="0" width="32" height="20" fill-opacity="0.6"/>
            <rect x="96" y="0" width="32" height="20" fill-opacity="0.4"/>
            <rect x="128" y="0" width="32" height="20" fill-opacity="0.2"/>

            <rect x="0" y="20" width="32" height="20" fill-opacity="0.4"/>
            <rect x="32" y="20" width="32" height="20" fill-opacity="0.7"/>
            <rect x="64" y="20" width="32" height="20" fill-opacity="0.85"/>
            <rect x="96" y="20" width="32" height="20" fill-opacity="0.7"/>
            <rect x="128" y="20" width="32" height="20" fill-opacity="0.4"/>

            <rect x="0" y="40" width="32" height="20" fill-opacity="0.6"/>
            <rect x="32" y="40" width="32" height="20" fill-opacity="0.85"/>
            <rect x="64" y="40" width="32" height="20" fill="#3b82f6"/>
            <rect x="96" y="40" width="32" height="20" fill-opacity="0.85"/>
            <rect x="128" y="40" width="32" height="20" fill-opacity="0.6"/>

            <rect x="0" y="60" width="32" height="20" fill-opacity="0.4"/>
            <rect x="32" y="60" width="32" height="20" fill-opacity="0.7"/>
            <rect x="64" y="60" width="32" height="20" fill-opacity="0.85"/>
            <rect x="96" y="60" width="32" height="20" fill-opacity="0.7"/>
            <rect x="128" y="60" width="32" height="20" fill-opacity="0.4"/>

            <rect x="0" y="80" width="32" height="20" fill-opacity="0.2"/>
            <rect x="32" y="80" width="32" height="20" fill-opacity="0.4"/>
            <rect x="64" y="80" width="32" height="20" fill-opacity="0.6"/>
            <rect x="96" y="80" width="32" height="20" fill-opacity="0.4"/>
            <rect x="128" y="80" width="32" height="20" fill-opacity="0.2"/>
          </g>

          <!-- Center pixel label -->
          <text x="80" y="56" fill="white" font-family="Segoe UI, sans-serif" font-size="9" font-weight="600" text-anchor="middle">1.0</text>
        </g>

        <text x="100" y="120" fill="#666" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">Closer pixels → higher weight</text>
      </g>
    </g>

    <!-- Multiply symbol -->
    <g transform="translate(220, 100)">
      <text x="20" y="0" fill="#1a3a6e" font-family="Segoe UI, sans-serif" font-size="28" font-weight="600" text-anchor="middle">×</text>
    </g>

    <!-- Range Weight (Center) -->
    <g transform="translate(270, 0)">
      <text x="100" y="0" fill="#10b981" font-family="Segoe UI, sans-serif" font-size="14" font-weight="600" text-anchor="middle">Range Weight (G<tspan font-size="10" dy="3">r</tspan><tspan dy="-3">)</tspan></text>
      <text x="100" y="18" fill="#666" font-family="Segoe UI, sans-serif" font-size="11" text-anchor="middle">Intensity similarity</text>

      <!-- Intensity-based weights -->
      <g transform="translate(0, 35)">
        <rect x="0" y="0" width="200" height="130" fill="white" rx="6" stroke="#10b981" stroke-width="1"/>

        <!-- Example with edge -->
        <g transform="translate(20, 15)">
          <!-- Left side (similar intensity - high weight) -->
          <g fill="#d1fae5" stroke="#10b981" stroke-width="0.5">
            <rect x="0" y="0" width="32" height="100" fill-opacity="0.9"/>
            <rect x="32" y="0" width="32" height="100" fill-opacity="0.95"/>
            <rect x="64" y="0" width="32" height="100" fill="#10b981"/>
          </g>

          <!-- Right side (different intensity - low weight) -->
          <g fill="#fee2e2" stroke="#ef4444" stroke-width="0.5">
            <rect x="96" y="0" width="32" height="100" fill-opacity="0.3"/>
            <rect x="128" y="0" width="32" height="100" fill-opacity="0.15"/>
          </g>

          <!-- Labels -->
          <text x="48" y="55" fill="#10b981" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">similar</text>
          <text x="112" y="55" fill="#ef4444" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">different</text>

          <!-- Edge line -->
          <line x1="80" y1="0" x2="80" y2="100" stroke="#1a3a6e" stroke-width="2" stroke-dasharray="4,2"/>
        </g>

        <text x="100" y="120" fill="#666" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">Similar intensity → higher weight</text>
      </g>
    </g>

    <!-- Equals symbol -->
    <g transform="translate(490, 100)">
      <text x="20" y="0" fill="#1a3a6e" font-family="Segoe UI, sans-serif" font-size="28" font-weight="600" text-anchor="middle">=</text>
    </g>

    <!-- Result (Right) -->
    <g transform="translate(540, 0)">
      <text x="100" y="0" fill="#7c3aed" font-family="Segoe UI, sans-serif" font-size="14" font-weight="600" text-anchor="middle">Combined Weight</text>
      <text x="100" y="18" fill="#666" font-family="Segoe UI, sans-serif" font-size="11" text-anchor="middle">Edge-preserving blur</text>

      <!-- Combined result -->
      <g transform="translate(0, 35)">
        <rect x="0" y="0" width="200" height="130" fill="white" rx="6" stroke="#7c3aed" stroke-width="1"/>

        <g transform="translate(20, 15)">
          <!-- Left side gets blur (high combined weight) -->
          <g fill="#c4b5fd" stroke="#7c3aed" stroke-width="0.5">
            <rect x="0" y="0" width="32" height="100" fill-opacity="0.2"/>
            <rect x="32" y="0" width="32" height="100" fill-opacity="0.7"/>
            <rect x="64" y="0" width="32" height="100" fill="#7c3aed"/>
          </g>

          <!-- Right side stays sharp (low combined weight) -->
          <g fill="#fafafa" stroke="#ccc" stroke-width="0.5">
            <rect x="96" y="0" width="32" height="100" fill-opacity="0.1"/>
            <rect x="128" y="0" width="32" height="100" fill-opacity="0.05"/>
          </g>

          <!-- Edge preserved -->
          <line x1="80" y1="0" x2="80" y2="100" stroke="#1a3a6e" stroke-width="3"/>
          <text x="80" y="115" fill="#1a3a6e" font-family="Segoe UI, sans-serif" font-size="8" font-weight="600" text-anchor="middle">EDGE PRESERVED!</text>
        </g>
      </g>
    </g>
  </g>

  <!-- Bottom comparison -->
  <g transform="translate(100, 320)">
    <text x="300" y="0" fill="#1a3a6e" font-family="Segoe UI, sans-serif" font-size="13" font-weight="600" text-anchor="middle">Result Comparison</text>

    <!-- Original -->
    <g transform="translate(0, 20)">
      <rect x="0" y="0" width="180" height="60" fill="#333" rx="4"/>
      <rect x="90" y="0" width="90" height="60" fill="#ccc" rx="0 4 4 0"/>
      <line x1="90" y1="0" x2="90" y2="60" stroke="#1a3a6e" stroke-width="2"/>
      <text x="90" y="75" fill="#666" font-family="Segoe UI, sans-serif" font-size="10" text-anchor="middle">Original (sharp edge)</text>
    </g>

    <!-- Gaussian blur -->
    <g transform="translate(210, 20)">
      <rect x="0" y="0" width="180" height="60" fill="#555" rx="4"/>
      <rect x="70" y="0" width="40" height="60" fill="#888"/>
      <rect x="110" y="0" width="70" height="60" fill="#aaa" rx="0 4 4 0"/>
      <text x="90" y="75" fill="#666" font-family="Segoe UI, sans-serif" font-size="10" text-anchor="middle">Gaussian (blurred edge)</text>
    </g>

    <!-- Bilateral -->
    <g transform="translate(420, 20)">
      <rect x="0" y="0" width="180" height="60" fill="#444" rx="4"/>
      <rect x="90" y="0" width="90" height="60" fill="#bbb" rx="0 4 4 0"/>
      <line x1="90" y1="0" x2="90" y2="60" stroke="#1a3a6e" stroke-width="2"/>
      <text x="90" y="75" fill="#10b981" font-family="Segoe UI, sans-serif" font-size="10" font-weight="600" text-anchor="middle">Bilateral (edge preserved!)</text>
    </g>
  </g>
</svg>