<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 400" role="img" aria-label="Faster R-CNN two-stage detection pipeline">
  <title>Faster R-CNN Pipeline</title>
  <desc>Two-stage object detection architecture showing feature extraction, region proposal network, and final classification/regression heads</desc>

  <defs>
    <linearGradient id="frcnnBg" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f8f9fa"/>
      <stop offset="100%" style="stop-color:#e9ecef"/>
    </linearGradient>
    <marker id="arrowFrcnn" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>

  <rect width="850" height="400" fill="url(#frcnnBg)" rx="8"/>

  <!-- Title -->
  <text x="425" y="32" fill="#1a3a6e" font-family="Segoe UI, sans-serif" font-size="20" font-weight="600" text-anchor="middle">Faster R-CNN: Two-Stage Detection</text>

  <!-- Pipeline -->
  <g transform="translate(30, 55)">
    <rect x="0" y="0" width="790" height="180" fill="white" rx="8" stroke="#3b82f6" stroke-width="2"/>

    <g transform="translate(25, 25)">
      <!-- Input image -->
      <g transform="translate(0, 20)">
        <rect x="0" y="0" width="80" height="80" fill="#e5e7eb" rx="4" stroke="#666"/>
        <ellipse cx="40" cy="35" rx="25" ry="20" fill="#9ca3af"/>
        <rect x="50" y="55" width="20" height="15" fill="#6b7280"/>
        <text x="40" y="100" fill="#666" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">Input Image</text>
      </g>

      <!-- Arrow -->
      <path d="M90,60 L115,60" stroke="#666" stroke-width="1.5" marker-end="url(#arrowFrcnn)"/>

      <!-- Backbone CNN -->
      <g transform="translate(125, 10)">
        <rect x="0" y="0" width="100" height="100" fill="#dbeafe" rx="6" stroke="#3b82f6"/>
        <text x="50" y="25" fill="#3b82f6" font-family="Segoe UI, sans-serif" font-size="10" font-weight="600" text-anchor="middle">Backbone</text>
        <text x="50" y="40" fill="#3b82f6" font-family="Segoe UI, sans-serif" font-size="10" text-anchor="middle">CNN</text>
        <g transform="translate(20, 50)">
          <rect x="0" y="0" width="60" height="35" fill="#93c5fd" rx="3"/>
          <text x="30" y="22" fill="#3b82f6" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">ResNet/VGG</text>
        </g>
        <text x="50" y="115" fill="#666" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">Feature Maps</text>
      </g>

      <!-- Arrow -->
      <path d="M235,60 L260,60" stroke="#666" stroke-width="1.5" marker-end="url(#arrowFrcnn)"/>

      <!-- RPN -->
      <g transform="translate(270, 5)">
        <rect x="0" y="0" width="110" height="110" fill="#d1fae5" rx="6" stroke="#10b981" stroke-width="2"/>
        <text x="55" y="20" fill="#10b981" font-family="Segoe UI, sans-serif" font-size="10" font-weight="600" text-anchor="middle">Region Proposal</text>
        <text x="55" y="35" fill="#10b981" font-family="Segoe UI, sans-serif" font-size="10" text-anchor="middle">Network (RPN)</text>
        <g transform="translate(10, 45)">
          <rect x="0" y="0" width="90" height="22" fill="#a7f3d0" rx="3"/>
          <text x="45" y="15" fill="#10b981" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">Objectness score</text>
        </g>
        <g transform="translate(10, 72)">
          <rect x="0" y="0" width="90" height="22" fill="#a7f3d0" rx="3"/>
          <text x="45" y="15" fill="#10b981" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">Box regression</text>
        </g>
        <text x="55" y="125" fill="#10b981" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle" font-weight="600">~2000 proposals</text>
      </g>

      <!-- Arrow -->
      <path d="M390,60 L415,60" stroke="#666" stroke-width="1.5" marker-end="url(#arrowFrcnn)"/>

      <!-- RoI Pooling -->
      <g transform="translate(425, 15)">
        <rect x="0" y="0" width="90" height="90" fill="#f5f3ff" rx="6" stroke="#7c3aed"/>
        <text x="45" y="20" fill="#7c3aed" font-family="Segoe UI, sans-serif" font-size="10" font-weight="600" text-anchor="middle">RoI</text>
        <text x="45" y="35" fill="#7c3aed" font-family="Segoe UI, sans-serif" font-size="10" text-anchor="middle">Pooling</text>
        <g transform="translate(15, 45)">
          <rect x="0" y="0" width="60" height="30" fill="#ddd6fe" rx="3"/>
          <text x="30" y="12" fill="#7c3aed" font-family="Segoe UI, sans-serif" font-size="7" text-anchor="middle">Extract fixed</text>
          <text x="30" y="24" fill="#7c3aed" font-family="Segoe UI, sans-serif" font-size="7" text-anchor="middle">size features</text>
        </g>
        <text x="45" y="105" fill="#666" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">7×7 per RoI</text>
      </g>

      <!-- Arrow -->
      <path d="M525,60 L550,60" stroke="#666" stroke-width="1.5" marker-end="url(#arrowFrcnn)"/>

      <!-- Detection heads -->
      <g transform="translate(560, 0)">
        <rect x="0" y="0" width="170" height="120" fill="#fef3c7" rx="6" stroke="#f97316" stroke-width="2"/>
        <text x="85" y="20" fill="#f97316" font-family="Segoe UI, sans-serif" font-size="10" font-weight="600" text-anchor="middle">Detection Heads</text>

        <!-- FC layers -->
        <g transform="translate(15, 30)">
          <rect x="0" y="0" width="55" height="35" fill="#fed7aa" rx="3"/>
          <text x="27" y="15" fill="#f97316" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">FC</text>
          <text x="27" y="28" fill="#f97316" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">layers</text>
        </g>

        <!-- Classification head -->
        <g transform="translate(80, 30)">
          <rect x="0" y="0" width="75" height="35" fill="#fef2f2" rx="3" stroke="#ef4444"/>
          <text x="37" y="15" fill="#ef4444" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">Classifier</text>
          <text x="37" y="28" fill="#ef4444" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">(C+1 classes)</text>
        </g>

        <!-- Box regression head -->
        <g transform="translate(80, 70)">
          <rect x="0" y="0" width="75" height="35" fill="#dbeafe" rx="3" stroke="#3b82f6"/>
          <text x="37" y="15" fill="#3b82f6" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">Box Refiner</text>
          <text x="37" y="28" fill="#3b82f6" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">(4 × C)</text>
        </g>
      </g>
    </g>
  </g>

  <!-- Stage labels -->
  <g transform="translate(30, 245)">
    <rect x="0" y="0" width="790" height="130" fill="white" rx="8" stroke="#7c3aed" stroke-width="2"/>
    <text x="395" y="22" fill="#7c3aed" font-family="Segoe UI, sans-serif" font-size="12" font-weight="600" text-anchor="middle">Two-Stage Architecture</text>

    <g transform="translate(30, 40)">
      <!-- Stage 1 -->
      <g transform="translate(0, 0)">
        <rect x="0" y="0" width="350" height="70" fill="#d1fae5" rx="6"/>
        <text x="175" y="20" fill="#10b981" font-family="Segoe UI, sans-serif" font-size="11" font-weight="600" text-anchor="middle">Stage 1: Region Proposal</text>
        <text x="175" y="38" fill="#666" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">• Generate candidate regions (RPN)</text>
        <text x="175" y="53" fill="#666" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">• Filter by objectness score</text>
        <text x="175" y="68" fill="#999" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">"Where might objects be?"</text>
      </g>

      <!-- Arrow -->
      <text x="365" y="35" fill="#333" font-family="Segoe UI, sans-serif" font-size="20">→</text>

      <!-- Stage 2 -->
      <g transform="translate(385, 0)">
        <rect x="0" y="0" width="350" height="70" fill="#fef3c7" rx="6"/>
        <text x="175" y="20" fill="#f97316" font-family="Segoe UI, sans-serif" font-size="11" font-weight="600" text-anchor="middle">Stage 2: Detection</text>
        <text x="175" y="38" fill="#666" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">• Classify each proposal</text>
        <text x="175" y="53" fill="#666" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">• Refine bounding box coordinates</text>
        <text x="175" y="68" fill="#999" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">"What is it exactly?"</text>
      </g>
    </g>
  </g>
</svg>
