<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 400" role="img" aria-label="VAE decoder network reconstructing images from latent vectors">
  <title>VAE Decoder</title>
  <desc>Detailed view of VAE decoder showing how latent vectors are upsampled and transformed back into images</desc>

  <defs>
    <linearGradient id="vaeDecBg" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f8f9fa"/>
      <stop offset="100%" style="stop-color:#e9ecef"/>
    </linearGradient>
    <marker id="vaeDecArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>

  <rect width="850" height="400" fill="url(#vaeDecBg)" rx="8"/>

  <!-- Title -->
  <text x="425" y="32" fill="#1a3a6e" font-family="Segoe UI, sans-serif" font-size="20" font-weight="600" text-anchor="middle">VAE Decoder: Generative Network p(x|z)</text>

  <!-- Decoder architecture -->
  <g transform="translate(30, 55)">
    <rect x="0" y="0" width="510" height="320" fill="white" rx="8" stroke="#f97316" stroke-width="2"/>
    <text x="255" y="22" fill="#f97316" font-family="Segoe UI, sans-serif" font-size="13" font-weight="600" text-anchor="middle">Decoder Architecture</text>

    <!-- Latent input -->
    <g transform="translate(25, 75)">
      <rect x="0" y="0" width="50" height="60" fill="#d1fae5" stroke="#10b981" stroke-width="3" rx="4"/>
      <text x="25" y="35" fill="#10b981" font-family="Segoe UI, sans-serif" font-size="14" font-weight="600" text-anchor="middle">z</text>
      <text x="25" y="80" fill="#10b981" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">Latent</text>
      <text x="25" y="95" fill="#666" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">dim: 20</text>
    </g>

    <!-- Dense layer -->
    <g transform="translate(100, 70)">
      <rect x="0" y="0" width="50" height="70" fill="#f97316" rx="4"/>
      <text x="25" y="28" fill="white" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">Dense</text>
      <text x="25" y="45" fill="white" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">256</text>
      <text x="25" y="60" fill="white" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">ReLU</text>
    </g>

    <!-- Dense to reshape -->
    <g transform="translate(170, 65)">
      <rect x="0" y="0" width="50" height="80" fill="#fb923c" rx="4"/>
      <text x="25" y="28" fill="white" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">Dense</text>
      <text x="25" y="45" fill="white" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">3136</text>
      <text x="25" y="60" fill="white" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">ReLU</text>
      <text x="25" y="100" fill="#666" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">7×7×64</text>
    </g>

    <!-- Reshape -->
    <g transform="translate(240, 75)">
      <rect x="0" y="0" width="50" height="60" fill="#fdba74" rx="4"/>
      <text x="25" y="35" fill="#7c2d12" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">Reshape</text>
      <text x="25" y="80" fill="#666" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">7×7×64</text>
    </g>

    <!-- Transposed convolutions -->
    <g transform="translate(310, 60)">
      <rect x="0" y="0" width="60" height="90" fill="#f97316" rx="4"/>
      <text x="30" y="30" fill="white" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">DeConv</text>
      <text x="30" y="48" fill="white" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">64 filters</text>
      <text x="30" y="63" fill="white" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">stride 2</text>
      <text x="30" y="78" fill="white" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">ReLU</text>
      <text x="30" y="110" fill="#666" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">14×14×64</text>
    </g>

    <g transform="translate(390, 50)">
      <rect x="0" y="0" width="60" height="110" fill="#fb923c" rx="4"/>
      <text x="30" y="35" fill="white" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">DeConv</text>
      <text x="30" y="53" fill="white" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">32 filters</text>
      <text x="30" y="68" fill="white" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">stride 2</text>
      <text x="30" y="83" fill="white" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">Sigmoid</text>
      <text x="30" y="130" fill="#666" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">28×28×1</text>
    </g>

    <!-- Output image -->
    <g transform="translate(470, 65)">
      <rect x="0" y="0" width="80" height="80" fill="#fef2f2" stroke="#ef4444" stroke-width="2" rx="4"/>
      <!-- Simple face representation -->
      <ellipse cx="40" cy="40" rx="28" ry="30" fill="#fcd34d"/>
      <circle cx="30" cy="35" r="5" fill="#333"/>
      <circle cx="50" cy="35" r="5" fill="#333"/>
      <path d="M32,50 Q40,58 48,50" fill="none" stroke="#333" stroke-width="2"/>
      <text x="40" y="100" fill="#ef4444" font-family="Segoe UI, sans-serif" font-size="10" text-anchor="middle">Output x̂</text>
      <text x="40" y="115" fill="#666" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">28×28×1</text>
    </g>

    <!-- Arrows -->
    <line x1="75" y1="105" x2="97" y2="105" stroke="#666" stroke-width="2" marker-end="url(#vaeDecArrow)"/>
    <line x1="150" y1="105" x2="167" y2="105" stroke="#666" stroke-width="2" marker-end="url(#vaeDecArrow)"/>
    <line x1="220" y1="105" x2="237" y2="105" stroke="#666" stroke-width="2" marker-end="url(#vaeDecArrow)"/>
    <line x1="290" y1="105" x2="307" y2="105" stroke="#666" stroke-width="2" marker-end="url(#vaeDecArrow)"/>
    <line x1="370" y1="105" x2="387" y2="105" stroke="#666" stroke-width="2" marker-end="url(#vaeDecArrow)"/>
    <line x1="450" y1="105" x2="467" y2="105" stroke="#666" stroke-width="2" marker-end="url(#vaeDecArrow)"/>

    <!-- Transposed convolution explanation -->
    <g transform="translate(25, 200)">
      <rect x="0" y="0" width="460" height="105" fill="#f8f9fa" rx="4"/>
      <text x="230" y="20" fill="#1a3a6e" font-family="Segoe UI, sans-serif" font-size="11" font-weight="600" text-anchor="middle">Transposed Convolution (Deconvolution)</text>

      <g transform="translate(15, 35)" font-family="Segoe UI, sans-serif" font-size="9">
        <circle cx="5" cy="5" r="3" fill="#f97316"/>
        <text x="15" y="9" fill="#666">Upsamples spatial dimensions (opposite of pooling)</text>

        <circle cx="5" cy="25" r="3" fill="#fb923c"/>
        <text x="15" y="29" fill="#666">Stride 2 → doubles width and height</text>

        <circle cx="5" cy="45" r="3" fill="#fdba74"/>
        <text x="15" y="49" fill="#666">Final activation: Sigmoid for [0,1] pixel values</text>
      </g>
    </g>
  </g>

  <!-- Generation process -->
  <g transform="translate(555, 55)">
    <rect x="0" y="0" width="265" height="160" fill="white" rx="8" stroke="#10b981" stroke-width="2"/>
    <text x="132" y="22" fill="#10b981" font-family="Segoe UI, sans-serif" font-size="12" font-weight="600" text-anchor="middle">Generation Process</text>

    <g transform="translate(15, 45)" font-family="Segoe UI, sans-serif" font-size="10">
      <g>
        <circle cx="10" cy="10" r="8" fill="#3b82f6"/>
        <text x="10" y="14" fill="white" font-size="10" text-anchor="middle">1</text>
        <text x="28" y="14" fill="#333">Sample z ~ N(0, I)</text>
      </g>

      <g transform="translate(0, 30)">
        <circle cx="10" cy="10" r="8" fill="#10b981"/>
        <text x="10" y="14" fill="white" font-size="10" text-anchor="middle">2</text>
        <text x="28" y="14" fill="#333">Feed z to decoder</text>
      </g>

      <g transform="translate(0, 60)">
        <circle cx="10" cy="10" r="8" fill="#f97316"/>
        <text x="10" y="14" fill="white" font-size="10" text-anchor="middle">3</text>
        <text x="28" y="14" fill="#333">Output: new image!</text>
      </g>
    </g>

    <rect x="15" y="120" width="235" height="25" fill="#d1fae5" rx="3"/>
    <text x="132" y="137" fill="#10b981" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">No need for real input during generation</text>
  </g>

  <!-- Output distribution -->
  <g transform="translate(555, 230)">
    <rect x="0" y="0" width="265" height="145" fill="white" rx="8" stroke="#7c3aed" stroke-width="2"/>
    <text x="132" y="22" fill="#7c3aed" font-family="Segoe UI, sans-serif" font-size="12" font-weight="600" text-anchor="middle">Output Interpretation</text>

    <g transform="translate(15, 45)" font-family="Segoe UI, sans-serif" font-size="10">
      <text x="0" y="0" fill="#333">Decoder outputs parameters of p(x|z):</text>

      <rect x="0" y="15" width="235" height="30" fill="#f5f3ff" rx="3"/>
      <text x="117" y="35" fill="#7c3aed" font-family="Consolas, monospace" font-size="10" text-anchor="middle">x̂ = μ_x(z) for Gaussian</text>

      <text x="0" y="65" fill="#666" font-size="9">For images (Bernoulli output):</text>
      <text x="0" y="82" fill="#666" font-size="9">• Output = probability per pixel</text>
      <text x="0" y="97" fill="#666" font-size="9">• Sigmoid ensures values in [0, 1]</text>
    </g>
  </g>
</svg>
