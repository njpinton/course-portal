<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 400" role="img" aria-label="Variational autoencoder architecture with probabilistic latent space">
  <title>VAE Architecture</title>
  <desc>Variational autoencoder showing encoder producing mean and variance parameters for probabilistic sampling in latent space</desc>

  <defs>
    <linearGradient id="vaeBg" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f8f9fa"/>
      <stop offset="100%" style="stop-color:#e9ecef"/>
    </linearGradient>
    <marker id="vaeArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>

  <rect width="850" height="400" fill="url(#vaeBg)" rx="8"/>

  <!-- Title -->
  <text x="425" y="32" fill="#1a3a6e" font-family="Segoe UI, sans-serif" font-size="20" font-weight="600" text-anchor="middle">Variational Autoencoder (VAE) Architecture</text>

  <!-- Main diagram -->
  <g transform="translate(30, 50)">
    <rect x="0" y="0" width="790" height="195" fill="white" rx="8" stroke="#7c3aed" stroke-width="2"/>

    <!-- Input -->
    <g transform="translate(25, 55)">
      <rect x="0" y="0" width="60" height="60" fill="#dbeafe" stroke="#3b82f6" stroke-width="2" rx="4"/>
      <text x="30" y="35" fill="#3b82f6" font-family="Segoe UI, sans-serif" font-size="12" font-weight="600" text-anchor="middle">x</text>
      <text x="30" y="80" fill="#666" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">Input</text>
    </g>

    <!-- Encoder -->
    <g transform="translate(110, 35)">
      <rect x="0" y="0" width="130" height="100" fill="#f5f3ff" stroke="#7c3aed" stroke-width="2" rx="6"/>
      <text x="65" y="20" fill="#7c3aed" font-family="Segoe UI, sans-serif" font-size="11" font-weight="600" text-anchor="middle">Encoder</text>
      <text x="65" y="35" fill="#7c3aed" font-family="Segoe UI, sans-serif" font-size="10" text-anchor="middle">q(z|x)</text>

      <!-- Neural network layers -->
      <rect x="20" y="45" width="90" height="45" fill="#7c3aed" rx="4"/>
      <text x="65" y="65" fill="white" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">Neural Net</text>
      <text x="65" y="78" fill="white" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">(FC layers)</text>
    </g>

    <!-- Mean and variance outputs -->
    <g transform="translate(265, 25)">
      <!-- μ branch -->
      <rect x="0" y="0" width="50" height="50" fill="#3b82f6" rx="4"/>
      <text x="25" y="30" fill="white" font-family="Segoe UI, sans-serif" font-size="14" font-weight="600" text-anchor="middle">μ</text>
      <text x="25" y="65" fill="#3b82f6" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">Mean</text>

      <!-- σ branch -->
      <rect x="0" y="80" width="50" height="50" fill="#10b981" rx="4"/>
      <text x="25" y="110" fill="white" font-family="Segoe UI, sans-serif" font-size="14" font-weight="600" text-anchor="middle">σ²</text>
      <text x="25" y="145" fill="#10b981" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">Variance</text>
    </g>

    <!-- Sampling -->
    <g transform="translate(340, 45)">
      <rect x="0" y="0" width="100" height="80" fill="#fef3c7" stroke="#f97316" stroke-width="2" rx="6"/>
      <text x="50" y="22" fill="#f97316" font-family="Segoe UI, sans-serif" font-size="10" font-weight="600" text-anchor="middle">Sampling</text>
      <text x="50" y="45" fill="#f97316" font-family="Consolas, monospace" font-size="10" text-anchor="middle">z = μ + σ·ε</text>
      <text x="50" y="65" fill="#666" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">ε ~ N(0, 1)</text>
    </g>

    <!-- Epsilon input -->
    <g transform="translate(380, 140)">
      <ellipse cx="20" cy="15" rx="18" ry="15" fill="#f8f9fa" stroke="#666" stroke-width="1"/>
      <text x="20" y="19" fill="#666" font-family="Segoe UI, sans-serif" font-size="10" text-anchor="middle">ε</text>
    </g>

    <!-- Latent z -->
    <g transform="translate(465, 55)">
      <rect x="0" y="0" width="50" height="60" fill="#d1fae5" stroke="#10b981" stroke-width="3" rx="4"/>
      <text x="25" y="35" fill="#10b981" font-family="Segoe UI, sans-serif" font-size="14" font-weight="600" text-anchor="middle">z</text>
      <text x="25" y="78" fill="#10b981" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">Latent</text>
    </g>

    <!-- Decoder -->
    <g transform="translate(540, 35)">
      <rect x="0" y="0" width="130" height="100" fill="#fef2f2" stroke="#ef4444" stroke-width="2" rx="6"/>
      <text x="65" y="20" fill="#ef4444" font-family="Segoe UI, sans-serif" font-size="11" font-weight="600" text-anchor="middle">Decoder</text>
      <text x="65" y="35" fill="#ef4444" font-family="Segoe UI, sans-serif" font-size="10" text-anchor="middle">p(x|z)</text>

      <rect x="20" y="45" width="90" height="45" fill="#ef4444" rx="4"/>
      <text x="65" y="65" fill="white" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">Neural Net</text>
      <text x="65" y="78" fill="white" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">(FC layers)</text>
    </g>

    <!-- Output -->
    <g transform="translate(695, 55)">
      <rect x="0" y="0" width="60" height="60" fill="#fef2f2" stroke="#ef4444" stroke-width="2" rx="4"/>
      <text x="30" y="35" fill="#ef4444" font-family="Segoe UI, sans-serif" font-size="12" font-weight="600" text-anchor="middle">x̂</text>
      <text x="30" y="80" fill="#666" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">Output</text>
    </g>

    <!-- Connection arrows -->
    <line x1="85" y1="85" x2="107" y2="85" stroke="#666" stroke-width="2" marker-end="url(#vaeArrow)"/>
    <line x1="240" y1="70" x2="262" y2="50" stroke="#666" stroke-width="2" marker-end="url(#vaeArrow)"/>
    <line x1="240" y1="100" x2="262" y2="120" stroke="#666" stroke-width="2" marker-end="url(#vaeArrow)"/>
    <line x1="315" y1="50" x2="337" y2="70" stroke="#666" stroke-width="2" marker-end="url(#vaeArrow)"/>
    <line x1="315" y1="120" x2="337" y2="100" stroke="#666" stroke-width="2" marker-end="url(#vaeArrow)"/>
    <line x1="440" y1="85" x2="462" y2="85" stroke="#666" stroke-width="2" marker-end="url(#vaeArrow)"/>
    <line x1="515" y1="85" x2="537" y2="85" stroke="#666" stroke-width="2" marker-end="url(#vaeArrow)"/>
    <line x1="670" y1="85" x2="692" y2="85" stroke="#666" stroke-width="2" marker-end="url(#vaeArrow)"/>
    <line x1="400" y1="140" x2="400" y2="128" stroke="#666" stroke-width="1" marker-end="url(#vaeArrow)"/>
  </g>

  <!-- Loss function -->
  <g transform="translate(30, 260)">
    <rect x="0" y="0" width="400" height="115" fill="white" rx="8" stroke="#ef4444" stroke-width="2"/>
    <text x="200" y="22" fill="#ef4444" font-family="Segoe UI, sans-serif" font-size="12" font-weight="600" text-anchor="middle">VAE Loss Function (ELBO)</text>

    <g transform="translate(15, 40)" font-family="Segoe UI, sans-serif" font-size="10">
      <text x="0" y="0" fill="#3b82f6" font-family="Consolas, monospace" font-size="11">L = Reconstruction + KL Divergence</text>

      <text x="0" y="25" fill="#666" font-size="9">Reconstruction: ||x - x̂||² (data fidelity)</text>
      <text x="0" y="42" fill="#666" font-size="9">KL: D_KL(q(z|x) || p(z)) (regularization)</text>

      <rect x="0" y="52" width="370" height="20" fill="#dbeafe" rx="3"/>
      <text x="185" y="66" fill="#3b82f6" font-size="9" text-anchor="middle">Forces latent space to match N(0, 1) prior</text>
    </g>
  </g>

  <!-- Key differences -->
  <g transform="translate(450, 260)">
    <rect x="0" y="0" width="370" height="115" fill="white" rx="8" stroke="#10b981" stroke-width="2"/>
    <text x="185" y="22" fill="#10b981" font-family="Segoe UI, sans-serif" font-size="12" font-weight="600" text-anchor="middle">VAE vs Regular Autoencoder</text>

    <g transform="translate(15, 40)" font-family="Segoe UI, sans-serif" font-size="9">
      <g transform="translate(0, 0)">
        <rect x="0" y="0" width="165" height="60" fill="#f5f3ff" rx="4"/>
        <text x="82" y="15" fill="#7c3aed" font-weight="600" text-anchor="middle">Regular AE</text>
        <text x="82" y="32" fill="#666" text-anchor="middle">Deterministic z</text>
        <text x="82" y="47" fill="#666" text-anchor="middle">Point estimate</text>
      </g>

      <g transform="translate(175, 0)">
        <rect x="0" y="0" width="165" height="60" fill="#d1fae5" rx="4"/>
        <text x="82" y="15" fill="#10b981" font-weight="600" text-anchor="middle">VAE</text>
        <text x="82" y="32" fill="#666" text-anchor="middle">Probabilistic z ~ N(μ, σ²)</text>
        <text x="82" y="47" fill="#666" text-anchor="middle">Can sample new data!</text>
      </g>
    </g>
  </g>
</svg>
