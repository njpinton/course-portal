<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 400" role="img" aria-label="VAE encoder network producing mean and variance parameters">
  <title>VAE Encoder</title>
  <desc>Detailed view of VAE encoder showing how input is processed to produce mean and log-variance parameters for the latent distribution</desc>

  <defs>
    <linearGradient id="vaeEncBg" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f8f9fa"/>
      <stop offset="100%" style="stop-color:#e9ecef"/>
    </linearGradient>
    <marker id="vaeEncArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>

  <rect width="850" height="400" fill="url(#vaeEncBg)" rx="8"/>

  <!-- Title -->
  <text x="425" y="32" fill="#1a3a6e" font-family="Segoe UI, sans-serif" font-size="20" font-weight="600" text-anchor="middle">VAE Encoder: Recognition Network q(z|x)</text>

  <!-- Encoder architecture -->
  <g transform="translate(30, 55)">
    <rect x="0" y="0" width="510" height="320" fill="white" rx="8" stroke="#7c3aed" stroke-width="2"/>
    <text x="255" y="22" fill="#7c3aed" font-family="Segoe UI, sans-serif" font-size="13" font-weight="600" text-anchor="middle">Encoder Architecture</text>

    <!-- Input image -->
    <g transform="translate(25, 60)">
      <rect x="0" y="0" width="80" height="80" fill="#dbeafe" stroke="#3b82f6" stroke-width="2" rx="4"/>
      <!-- Simple face representation -->
      <ellipse cx="40" cy="40" rx="28" ry="30" fill="#fcd34d"/>
      <circle cx="30" cy="35" r="5" fill="#333"/>
      <circle cx="50" cy="35" r="5" fill="#333"/>
      <path d="M32,50 Q40,58 48,50" fill="none" stroke="#333" stroke-width="2"/>
      <text x="40" y="100" fill="#3b82f6" font-family="Segoe UI, sans-serif" font-size="10" text-anchor="middle">Input x</text>
      <text x="40" y="115" fill="#666" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">28×28×1</text>
    </g>

    <!-- Convolutional layers -->
    <g transform="translate(130, 50)">
      <rect x="0" y="0" width="60" height="100" fill="#7c3aed" rx="4"/>
      <text x="30" y="40" fill="white" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">Conv</text>
      <text x="30" y="55" fill="white" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">32 filters</text>
      <text x="30" y="70" fill="white" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">+ReLU</text>
      <text x="30" y="85" fill="white" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">+Pool</text>
      <text x="30" y="115" fill="#666" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">14×14×32</text>
    </g>

    <g transform="translate(210, 60)">
      <rect x="0" y="0" width="60" height="80" fill="#8b5cf6" rx="4"/>
      <text x="30" y="30" fill="white" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">Conv</text>
      <text x="30" y="45" fill="white" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">64 filters</text>
      <text x="30" y="60" fill="white" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">+ReLU</text>
      <text x="30" y="100" fill="#666" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">7×7×64</text>
    </g>

    <!-- Flatten -->
    <g transform="translate(290, 75)">
      <rect x="0" y="0" width="50" height="50" fill="#a78bfa" rx="4"/>
      <text x="25" y="30" fill="white" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">Flatten</text>
      <text x="25" y="70" fill="#666" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">3136</text>
    </g>

    <!-- Dense layer -->
    <g transform="translate(360, 70)">
      <rect x="0" y="0" width="50" height="60" fill="#7c3aed" rx="4"/>
      <text x="25" y="25" fill="white" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">Dense</text>
      <text x="25" y="40" fill="white" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">256</text>
      <text x="25" y="55" fill="white" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">ReLU</text>
    </g>

    <!-- Split to μ and σ -->
    <g transform="translate(430, 40)">
      <!-- μ head -->
      <rect x="0" y="0" width="55" height="50" fill="#3b82f6" rx="4"/>
      <text x="27" y="22" fill="white" font-family="Segoe UI, sans-serif" font-size="10" text-anchor="middle">Dense</text>
      <text x="27" y="40" fill="white" font-family="Segoe UI, sans-serif" font-size="14" font-weight="600" text-anchor="middle">μ</text>
      <text x="27" y="65" fill="#3b82f6" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">z_mean</text>
      <text x="27" y="80" fill="#666" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">dim: 20</text>

      <!-- log σ² head -->
      <rect x="0" y="100" width="55" height="50" fill="#10b981" rx="4"/>
      <text x="27" y="122" fill="white" font-family="Segoe UI, sans-serif" font-size="10" text-anchor="middle">Dense</text>
      <text x="27" y="140" fill="white" font-family="Segoe UI, sans-serif" font-size="12" font-weight="600" text-anchor="middle">log σ²</text>
      <text x="27" y="165" fill="#10b981" font-family="Segoe UI, sans-serif" font-size="9" text-anchor="middle">z_log_var</text>
      <text x="27" y="180" fill="#666" font-family="Segoe UI, sans-serif" font-size="8" text-anchor="middle">dim: 20</text>
    </g>

    <!-- Arrows -->
    <line x1="105" y1="100" x2="127" y2="100" stroke="#666" stroke-width="2" marker-end="url(#vaeEncArrow)"/>
    <line x1="190" y1="100" x2="207" y2="100" stroke="#666" stroke-width="2" marker-end="url(#vaeEncArrow)"/>
    <line x1="270" y1="100" x2="287" y2="100" stroke="#666" stroke-width="2" marker-end="url(#vaeEncArrow)"/>
    <line x1="340" y1="100" x2="357" y2="100" stroke="#666" stroke-width="2" marker-end="url(#vaeEncArrow)"/>
    <line x1="410" y1="85" x2="427" y2="65" stroke="#666" stroke-width="2" marker-end="url(#vaeEncArrow)"/>
    <line x1="410" y1="115" x2="427" y2="140" stroke="#666" stroke-width="2" marker-end="url(#vaeEncArrow)"/>

    <!-- Why log variance? -->
    <g transform="translate(25, 210)">
      <rect x="0" y="0" width="460" height="95" fill="#f8f9fa" rx="4"/>
      <text x="230" y="20" fill="#1a3a6e" font-family="Segoe UI, sans-serif" font-size="11" font-weight="600" text-anchor="middle">Why Predict log(σ²) Instead of σ?</text>

      <g transform="translate(15, 35)" font-family="Segoe UI, sans-serif" font-size="9">
        <circle cx="5" cy="5" r="3" fill="#3b82f6"/>
        <text x="15" y="9" fill="#666">Numerical stability: log(σ²) can be any real number</text>

        <circle cx="5" cy="25" r="3" fill="#10b981"/>
        <text x="15" y="29" fill="#666">σ = exp(0.5 × log(σ²)) ensures σ > 0</text>

        <circle cx="5" cy="45" r="3" fill="#7c3aed"/>
        <text x="15" y="49" fill="#666">Easier optimization during training</text>
      </g>
    </g>
  </g>

  <!-- Output explanation -->
  <g transform="translate(555, 55)">
    <rect x="0" y="0" width="265" height="155" fill="white" rx="8" stroke="#3b82f6" stroke-width="2"/>
    <text x="132" y="22" fill="#3b82f6" font-family="Segoe UI, sans-serif" font-size="12" font-weight="600" text-anchor="middle">Encoder Outputs</text>

    <g transform="translate(15, 40)" font-family="Segoe UI, sans-serif" font-size="10">
      <rect x="0" y="0" width="235" height="40" fill="#dbeafe" rx="4"/>
      <text x="117" y="17" fill="#3b82f6" font-weight="600" text-anchor="middle">μ (Mean Vector)</text>
      <text x="117" y="32" fill="#666" font-size="9" text-anchor="middle">Center of latent distribution</text>

      <rect x="0" y="50" width="235" height="40" fill="#d1fae5" rx="4"/>
      <text x="117" y="67" fill="#10b981" font-weight="600" text-anchor="middle">log(σ²) (Log Variance)</text>
      <text x="117" y="82" fill="#666" font-size="9" text-anchor="middle">Spread of latent distribution</text>
    </g>
  </g>

  <!-- Probabilistic interpretation -->
  <g transform="translate(555, 225)">
    <rect x="0" y="0" width="265" height="150" fill="white" rx="8" stroke="#10b981" stroke-width="2"/>
    <text x="132" y="22" fill="#10b981" font-family="Segoe UI, sans-serif" font-size="12" font-weight="600" text-anchor="middle">Probabilistic Interpretation</text>

    <g transform="translate(15, 40)" font-family="Segoe UI, sans-serif" font-size="10">
      <text x="0" y="0" fill="#333">Each input x maps to a distribution:</text>
      <text x="117" y="25" fill="#7c3aed" font-family="Consolas, monospace" font-size="11" text-anchor="middle">q(z|x) = N(μ(x), σ²(x))</text>

      <text x="0" y="55" fill="#666" font-size="9">• Different inputs → different distributions</text>
      <text x="0" y="72" fill="#666" font-size="9">• Uncertainty is explicitly modeled</text>
      <text x="0" y="89" fill="#666" font-size="9">• Enables smooth latent space</text>
    </g>
  </g>
</svg>
